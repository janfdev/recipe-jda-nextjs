generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String        @id @default(cuid())
  name         String?
  email        String        @unique
  password     String?
  image        String?
  role         Role          @default(USER)
  comments     Comment[]
  savedRecipes SavedRecipe[]
}

model Recipe {
  id           String        @id @default(cuid())
  title        String
  description  String
  image        String
  date         DateTime      @default(now())
  categoryId   String
  cookTime     Int?
  difficulty   String?
  prepTime     Int?
  rating       Float?
  servings     Int?
  comments     Comment[]
  ingredients  Ingredient[]
  instructions Instruction[]
  category     Category      @relation(fields: [categoryId], references: [id])
  tags         RecipeTag[]
  savedBy      SavedRecipe[]
}

model Category {
  id      String   @id @default(cuid())
  name    String   @unique
  recipes Recipe[]
}

model Ingredient {
  id       String @id @default(cuid())
  name     String
  recipeId String
  recipe   Recipe @relation(fields: [recipeId], references: [id])
}

model Instruction {
  id        String @id @default(cuid())
  step      String
  stepOrder Int
  recipeId  String
  recipe    Recipe @relation(fields: [recipeId], references: [id])
}

model Tag {
  id      String      @id @default(cuid())
  name    String      @unique
  recipes RecipeTag[]
}

model RecipeTag {
  id       String @id @default(cuid())
  recipeId String
  tagId    String
  recipe   Recipe @relation(fields: [recipeId], references: [id])
  tag      Tag    @relation(fields: [tagId], references: [id])

  @@unique([recipeId, tagId])
}

model SavedRecipe {
  id       String @id @default(cuid())
  userId   String
  recipeId String
  createdAt DateTime @default(now())

  recipe   Recipe @relation(fields: [recipeId], references: [id])
  user     User   @relation(fields: [userId], references: [id])

  @@unique([userId, recipeId])
  @@index([recipeId])
  @@index([userId])
}

model Comment {
  id        String   @id @default(cuid())
  content   String
  createdAt DateTime @default(now())
  userId    String
  recipeId  String
  recipe    Recipe   @relation(fields: [recipeId], references: [id])
  user      User     @relation(fields: [userId], references: [id])
}

enum Role {
  ADMIN
  USER
}


model Person {
  id           String              @id @default(cuid())
  name         String
  title        String?             // mis. "AI Engineer"
  org          String?             // mis. "Acme"
  avatarUrl    String?
  events       EventParticipant[]
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
}

// Role partisipan di event
enum ParticipantRole {
  SPEAKER
  MODERATOR
}

model EventParticipant {
  id        String           @id @default(cuid())
  eventId   String
  personId  String
  role      ParticipantRole
  talkTitle String          // judul materi utk speaker
  sortOrder Int?             // urutan tampil per role
  event     Event            @relation(fields: [eventId], references: [id], onDelete: Cascade)
  person    Person           @relation(fields: [personId], references: [id], onDelete: Restrict)

  // Satu orang boleh punya >1 role pada event yang sama (mis. SPEAKER & PANELIST),
  // tapi unik per (event, person, role)
  @@unique([eventId, personId, role])
}

model Event {
  id         String           @id @default(cuid())
  title      String
  startsAt   DateTime         
  endsAt     DateTime
  timezone   String           
  participants EventParticipant[]
  benefits     EventBenefit[]
  createdAt  DateTime         @default(now())
  updatedAt  DateTime         @updatedAt
}

model Benefit {
  id                 String          @id @default(cuid())
  key                String          @unique
  label              String
  defaultDescription String?
  iconUrl            String?
  events             EventBenefit[]
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt
}

model EventBenefit {
  id                 String   @id @default(cuid())
  eventId            String
  benefitId          String
  customDescription  String?
  isIncluded         Boolean  @default(true)
  sortOrder          Int?
  event              Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  benefit            Benefit  @relation(fields: [benefitId], references: [id], onDelete: Restrict)
  @@unique([eventId, benefitId])
}
